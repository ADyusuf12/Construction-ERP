<% content_for :title, "#{@report.report_type.humanize} Report | #{@project.name}" %>
<div class="bg-brand-white/30 dark:bg-brand-black/30 backdrop-blur-md border border-brand-secondary/20 rounded-2xl shadow-2xl p-8 mb-10 relative overflow-hidden animate-fade-in">
  <% status_style = @report.status_reviewed? ? 'bg-green-500' : (@report.status_submitted? ? 'bg-blue-500' : 'bg-brand-primary') %>
  <div class="absolute top-0 left-0 w-full h-1 <%= status_style %> opacity-40"></div>
  <div class="flex flex-col lg:flex-row justify-between items-start gap-6">
    <div class="flex-1">
      <div class="flex items-center gap-3 mb-2">
        <span class="px-2 py-0.5 rounded bg-brand-primary/10 border border-brand-primary/20 text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary">
          LOG ID #<%= @report.id %>
        </span>
        <div id="report_status_container">
          <span class="inline-flex items-center gap-1.5 text-[9px] font-black uppercase tracking-widest text-brand-secondary/50 dark:text-brand-primary/50">
            <span class="h-1.5 w-1.5 rounded-full <%= status_style %> <%= 'animate-pulse' if @report.status_submitted? %>"></span>
            <%= @report.status.humanize %>
          </span>
        </div>
      </div>
      <h2 class="text-3xl font-black text-brand-secondary dark:text-white uppercase tracking-tighter italic mb-4">
        <%= @report.report_type.humanize %> Operational Log
      </h2>
    </div>
    <div id="<%= dom_id(@report, :actions) %>" class="flex flex-wrap gap-2">
      <% if policy(@report).submit? %>
        <%= button_to submit_project_report_path(@report.project, @report), method: :patch, class: "px-4 py-2 rounded-xl bg-blue-600 text-white text-[10px] font-black uppercase tracking-widest shadow-lg hover:bg-blue-700 transition-all active:scale-95 cursor-pointer" do %>
          Submit for Review
        <% end %>
      <% end %>
      <% if policy(@report).review? %>
        <%= button_to review_project_report_path(@report.project, @report), method: :patch, class: "px-4 py-2 rounded-xl bg-green-600 text-white text-[10px] font-black uppercase tracking-widest shadow-lg hover:bg-green-700 transition-all active:scale-95 cursor-pointer" do %>
          Approve Log
        <% end %>
      <% end %>
      <%= link_to edit_project_report_path(@project, @report), class: "p-2.5 rounded-xl bg-brand-primary text-white hover:bg-brand-black transition-all shadow-md" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
          <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
      <% end %>
      <% if policy(@report).destroy? %>
        <button type="button"
          class="p-2.5 rounded-xl bg-red-500/10 text-red-600 border border-red-500/20 hover:bg-red-600 hover:text-white transition-all cursor-pointer"
          data-action="click->confirm-modal#open"
          data-confirm-modal-variant-param="danger"
          data-confirm-modal-title-param="Delete Log?"
          data-confirm-modal-message-param="Permanent removal of log dated <%= @report.report_date.strftime('%d.%m.%Y') %>."
          data-confirm-modal-confirm-path-param="<%= project_report_path(@project, @report) %>"
          data-confirm-modal-confirm-method-param="delete">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
        </button>
      <% end %>
    </div>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
    <div class="col-span-1 md:col-span-2 p-6 bg-white/40 dark:bg-black/20 border border-brand-secondary/10 rounded-2xl">
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-4">Progress Summary</p>
      <div class="text-sm text-brand-secondary/80 dark:text-brand-text-dark/80 leading-relaxed italic border-l-2 border-brand-primary/30 pl-4">
        <%= simple_format @report.progress_summary %>
      </div>
    </div>
    <% if @report.issues.present? %>
      <div class="p-6 bg-red-500/5 border border-red-500/10 rounded-2xl">
        <p class="text-[9px] font-black uppercase tracking-[0.2em] text-red-600 mb-4 flex items-center gap-2">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
          Operational Impediments
        </p>
        <p class="text-xs font-medium text-red-700 dark:text-red-400 whitespace-pre-line"><%= @report.issues %></p>
      </div>
    <% end %>
    <% if @report.next_steps.present? %>
      <div class="p-6 bg-green-500/5 border border-green-500/10 rounded-2xl">
        <p class="text-[9px] font-black uppercase tracking-[0.2em] text-green-600 mb-4 flex items-center gap-2">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
          Target Objectives
        </p>
        <p class="text-xs font-medium text-green-700 dark:text-green-400 whitespace-pre-line"><%= @report.next_steps %></p>
      </div>
    <% end %>
  </div>
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mt-10 pt-8 border-t border-brand-secondary/10">
    <div>
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-2">Filing Date</p>
      <p class="text-sm font-black text-brand-secondary dark:text-white font-mono tracking-tighter"><%= @report.report_date.strftime("%d.%m.%Y") %></p>
    </div>
    <div>
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-2">Submitted By</p>
      <% if @report.employee.present? %>
        <%= link_to hr_employee_path(@report.employee), class: "flex items-center gap-2 group" do %>
          <div class="h-6 w-6 rounded bg-brand-secondary/10 flex items-center justify-center text-[10px] font-black text-brand-secondary dark:text-brand-primary group-hover:bg-brand-primary group-hover:text-white transition-all">
            <%= @report.employee&.personal_detail&.first_name&.first %>
          </div>
          <span class="text-xs font-bold text-brand-secondary dark:text-white uppercase tracking-tight group-hover:text-brand-primary transition-colors">
            <%= @report.employee.full_name %>
          </span>
        <% end %>
      <% end %>
    </div>
    <div class="lg:col-span-2">
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-2">Site</p>
      <%= link_to @project.name, project_path(@project), class: "text-sm font-bold text-brand-secondary dark:text-white uppercase tracking-tight hover:text-brand-primary transition-colors" %>
    </div>
  </div>
</div>