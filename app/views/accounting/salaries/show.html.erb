<% content_for :title, "Salary: #{@salary.employee.full_name} | Earmark Finance" %>
<div class="bg-brand-white/30 dark:bg-brand-black/30 backdrop-blur-md border border-brand-secondary/20 rounded-2xl shadow-2xl p-8 mb-10 relative overflow-hidden animate-fade-in">
  <% status_color = @salary.status_paid? ? 'bg-green-500' : 'bg-brand-primary' %>
  <div class="absolute top-0 left-0 w-full h-1 <%= status_color %> opacity-40"></div>
  <div class="flex flex-col md:flex-row justify-between items-start gap-6">
    <div class="flex-1">
      <div class="flex items-center gap-3 mb-2">
        <span class="px-2 py-0.5 rounded bg-brand-secondary/10 border border-brand-secondary/20 text-[9px] font-black uppercase tracking-[0.2em] text-brand-secondary dark:text-brand-primary">
          Personnel Record
        </span>
        <span class="inline-flex items-center gap-1.5 text-[9px] font-black uppercase tracking-widest text-brand-secondary/50 dark:text-brand-primary/50">
          <span class="h-1.5 w-1.5 rounded-full <%= status_color %> <%= 'animate-pulse' unless @salary.status_paid? %>"></span>
          <%= @salary.status.humanize %>
        </span>
      </div>
      <h2 class="text-3xl font-black text-brand-secondary dark:text-white uppercase tracking-tighter italic">
        <%= @salary.employee.full_name %>
      </h2>
      <p class="text-[10px] font-bold text-brand-secondary/40 dark:text-white/40 uppercase tracking-widest mt-1">
        Employee ID: #<%= @salary.employee.id %>
      </p>
    </div>
    <div class="flex flex-wrap md:flex-nowrap gap-3">
      <% unless @salary.status_paid? %>
        <%= link_to new_accounting_deduction_path(salary_id: @salary.id),
            class: "flex items-center gap-2 px-5 py-2.5 rounded-xl bg-red-500 text-white text-[10px] font-black uppercase tracking-widest shadow-lg hover:bg-red-600 transition-all" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
          </svg>
          Add Deduction
        <% end %>
      <% end %>
      <%= link_to edit_accounting_salary_path(@salary),
          class: "flex items-center gap-2 px-5 py-2.5 rounded-xl bg-brand-primary text-white text-[10px] font-black uppercase tracking-widest shadow-lg hover:bg-brand-black transition-all" do %>
        Edit Voucher
      <% end %>
      <%= link_to accounting_salary_batch_path(@salary.batch),
          class: "flex items-center gap-2 px-5 py-2.5 rounded-xl bg-brand-secondary/10 text-brand-secondary dark:text-white border border-brand-secondary/20 text-[10px] font-black uppercase tracking-widest hover:bg-brand-secondary hover:text-white transition-all" do %>
        Back to Batch
      <% end %>
    </div>
  </div>
  <%# Financial Summary Grid %>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-10 p-6 rounded-2xl bg-brand-secondary/5 dark:bg-white/5 border border-brand-secondary/10">
    <div class="border-b md:border-b-0 md:border-r border-brand-secondary/10 pb-4 md:pb-0">
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-1">Base Salary</p>
      <p class="text-lg font-black text-brand-secondary dark:text-white font-mono tracking-tighter">
        <%= number_to_currency(@salary.base_pay, unit: "₦") %>
      </p>
    </div>
    <div class="border-b md:border-b-0 md:border-r border-brand-secondary/10 pb-4 md:pb-0">
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-1">Allowances</p>
      <p class="text-lg font-black text-green-600 font-mono tracking-tighter">
        + <%= number_to_currency(@salary.allowances, unit: "₦") %>
      </p>
    </div>
    <div class="border-b md:border-b-0 md:border-r border-brand-secondary/10 pb-4 md:pb-0">
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-1">Total Deductions</p>
      <p class="text-lg font-black text-red-500 font-mono tracking-tighter">
        - <%= number_to_currency(@salary.total_deductions, unit: "₦") %>
      </p>
    </div>
    <div>
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-1">Net Payable</p>
      <p class="text-2xl font-black text-brand-secondary dark:text-white font-mono tracking-tighter">
        <%= number_to_currency(@salary.net_pay, unit: "₦") %>
      </p>
    </div>
  </div>
  <%# Itemized Deductions Section %>
  <div class="mt-12">
    <div class="flex items-center gap-4 mb-6">
      <h3 class="text-[10px] font-black uppercase tracking-[0.3em] text-brand-secondary/50">Adjustment Breakdown</h3>
      <div class="h-px flex-1 bg-brand-secondary/10"></div>
    </div>
    <% if @deductions.any? %>
      <div class="overflow-hidden rounded-xl border border-brand-secondary/10 bg-white/5">
        <table class="w-full">
          <thead>
            <tr class="bg-brand-secondary/5 text-[9px] font-black uppercase tracking-widest text-brand-secondary/60">
              <th class="px-6 py-3 text-left">Deduction Type</th>
              <th class="px-6 py-3 text-left">Amount</th>
              <th class="px-6 py-3 text-left">Notation</th>
              <th class="px-6 py-3 text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-brand-secondary/5">
            <%= render partial: 'accounting/deductions/deduction_row',
                       collection: @deductions,
                       as: :deduction,
                       locals: { row_class: "hover:bg-white/10" } %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="py-12 text-center border-2 border-dashed border-brand-secondary/10 rounded-2xl">
        <p class="text-[10px] font-bold uppercase tracking-widest text-brand-secondary/30">No active deductions found for this cycle</p>
      </div>
    <% end %>
  </div>
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-8 mt-8 pt-8 border-t border-brand-secondary/10">
    <div>
      <p class="text-[9px] font-black uppercase tracking-[0.2em] text-brand-primary mb-2">Payment Verification</p>
      <% if @salary.status_paid? %>
        <p class="text-xs font-bold text-green-600 uppercase italic">✔ Disbursement Confirmed</p>
      <% else %>
        <p class="text-xs font-bold text-brand-primary uppercase italic animate-pulse">Pending Disbursement</p>
      <% end %>
    </div>
    <div class="text-right">
      <% if policy(@salary).destroy? %>
        <button type="button"
          class="text-[10px] font-black uppercase text-red-500/50 hover:text-red-600 transition-colors"
          data-action="click->confirm-modal#open"
          data-confirm-modal-variant-param="danger"
          data-confirm-modal-title-param="Void Salary Voucher?"
          data-confirm-modal-message-param="This will completely remove the salary record for <%= @salary.employee.full_name %>. Proceed?"
          data-confirm-modal-confirm-path-param="<%= accounting_salary_path(@salary) %>"
          data-confirm-modal-confirm-method-param="delete">
          Void Record
        </button>
      <% end %>
    </div>
  </div>
</div>