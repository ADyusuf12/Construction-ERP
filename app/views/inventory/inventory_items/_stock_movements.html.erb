<section class="bg-gradient-to-br from-white/40 via-hamzis-copper/6 to-hamzis-brown/6 dark:from-black/30 dark:via-hamzis-brown/10 dark:to-hamzis-copper/12
                border border-hamzis-brown/20 rounded-2xl shadow-lg p-6" aria-labelledby="recent-movements">
  <div class="flex items-center justify-between mb-4">
    <h3 id="recent-movements" class="text-lg font-semibold text-hamzis-brown dark:text-white underline">Recent Movements</h3>
    <div class="flex items-center gap-2">
      <% if policy([ :inventory, StockMovement.new ]).create? %>
        <%= link_to "➕ Record Movement", new_inventory_inventory_item_stock_movement_path(inventory_item),
            class: "inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-hamzis-copper text-white text-sm hover:brightness-95 transition" %>
      <% end %>
    </div>
  </div>
  <% if stock_movements.any? %>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-left">
        <thead>
          <tr class="text-xs uppercase tracking-wide text-hamzis-brown/80 dark:text-hamzis-copper/80">
            <th class="px-4 py-2">Date</th>
            <th class="px-4 py-2">Type / Status</th>
            <th class="px-4 py-2">Qty</th>
            <th class="px-4 py-2">Reference</th>
            <th class="px-4 py-2">By</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-hamzis-brown/10">
          <% stock_movements.each do |m| %>
            <% row_classes = [] %>
            <% row_classes << 'opacity-60' if m.cancelled? %>
            <tr class="hover:bg-white/50 dark:hover:bg-black/30 transition <%= row_classes.join(' ') %>">
              <td class="px-4 py-2"><%= l(m.created_at, format: :short) %></td>
              <td class="px-4 py-2">
                <span class="font-semibold"><%= m.movement_type.to_s.humanize %></span>
                <% if m.cancelled? %>
                  <span class="ml-2 text-xs text-yellow-700">(Cancelled)</span>
                <% elsif m.reversal_of_id.present? %>
                  <span class="ml-2 text-xs text-red-700">(Reversal)</span>
                <% elsif m.applied_at.present? %>
                  <span class="ml-2 text-xs text-green-700">(Applied)</span>
                <% else %>
                  <span class="ml-2 text-xs text-gray-600">(Pending)</span>
                <% end %>
              </td>
              <td class="px-4 py-2 font-medium">
                <%= m.quantity %>
                <span class="text-xs text-hamzis-copper ml-2"><%= inventory_item.unit.presence || "—" %></span>
              </td>
              <td class="px-4 py-2"><%= truncate(m.reference.to_s, length: 30) %></td>
              <td class="px-4 py-2"><%= m.employee&.full_name || "System" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="text-center py-8">
      <p class="text-sm text-gray-500">No movements recorded yet.</p>
    </div>
  <% end %>
</section>
