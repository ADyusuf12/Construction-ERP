<!DOCTYPE html>
<html>
  <head>
    <title>Hamzis Systems</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" unless Rails.env.test? %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>
  <body class="bg-hamzis-white text-hamzis-black dark:bg-hamzis-black dark:text-hamzis-white flex" data-controller="confirm-delete">
    <% if user_signed_in? %>
      <%= render 'shared/sidebar' %>
    <% end %>
    <!-- MAIN CONTENT -->
    <div class="flex-1 flex flex-col">
      <main class="px-6 py-6 flex-1">
        <%= render "shared/flash" %>
        <%= yield %>
      </main>
      <!-- FOOTER -->
      <footer class="bg-hamzis-white/10 backdrop-blur-md dark:bg-hamzis-black/20
                     border-t border-hamzis-brown/20 px-6 py-3">
        <div class="flex items-center justify-between">
          <p class="text-sm">Â© <%= Time.current.year %> Hamzis Systems â€” All rights reserved.</p>
          <button id="theme-toggle"
            aria-label="Toggle dark mode"
            class="px-3 py-1 rounded bg-hamzis-copper text-hamzis-white
                   hover:bg-hamzis-black hover:text-hamzis-white
                   dark:bg-hamzis-brown dark:text-hamzis-white transition-colors">
            <span id="theme-icon">ðŸŒ™</span>
          </button>
        </div>
      </footer>
    </div>
    <!-- THEME TOGGLE SCRIPT -->
    <script nonce="<%= content_security_policy_nonce %>">
      (() => {
        const root = document.documentElement;
        const storageKey = "hamzis-theme";
        const icon = document.getElementById("theme-icon");

        function applyTheme(dark) {
          root.classList.toggle("dark", dark);
          localStorage.setItem(storageKey, dark ? "dark" : "light");
          if (icon) icon.textContent = dark ? "ðŸŒž" : "ðŸŒ™";
        }

        function initTheme() {
          const saved = localStorage.getItem(storageKey);
          const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
          const initialDark = saved === "dark" || (!saved && prefersDark);
          applyTheme(initialDark);
        }

        function wireToggle() {
          const btn = document.getElementById("theme-toggle");
          if (!btn) return;
          btn.onclick = () => {
            const willBeDark = !root.classList.contains("dark");
            applyTheme(willBeDark);
          };
        }

        initTheme();
        wireToggle();
        document.addEventListener("turbo:load", () => {
          initTheme();
          wireToggle();
        });
      })();
    </script>
    <!-- NAV TOGGLE SCRIPT -->
    <script nonce="<%= content_security_policy_nonce %>">
      (() => {
        const navToggle = document.getElementById("nav-toggle");
        const navMenu = document.getElementById("nav-menu");

        if (navToggle && navMenu) {
          navToggle.addEventListener("click", () => {
            navMenu.classList.toggle("hidden");
          });
        }
      })();
    </script>
    <!-- CONFIRM DELETE MODAL -->
    <%= render 'shared/confirm_delete_modal',
        title: "Confirm Deletion",
        message: "Are you sure you want to delete this item? This action cannot be undone.",
        confirm_path: "#" %>
  </body>
</html>
