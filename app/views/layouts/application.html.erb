<!DOCTYPE html>
<html class="h-full">
  <head>
    <title>Hamzis Systems</title>
    <link rel="icon" type="image/svg+xml" href="<%= asset_path('hamzis-logo.svg') %>">
    <meta name="viewport" content="width=device-width, initial-scale=1, interactive-widget=resizes-content">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" unless Rails.env.test? %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <style>
      .custom-scrollbar::-webkit-scrollbar { width: 4px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(184, 115, 51, 0.2); border-radius: 10px; }
      .custom-scrollbar:hover::-webkit-scrollbar-thumb { background: rgba(184, 115, 51, 0.5); }
    </style>
  </head>
  <body class="bg-hamzis-white text-hamzis-black dark:bg-hamzis-black dark:text-hamzis-white flex h-screen overflow-hidden" data-controller="confirm-delete">
    <% if user_signed_in? %>
      <%= render 'shared/sidebar' %>
    <% end %>
    <div class="flex-1 flex flex-col min-w-0 h-full relative">
      <main class="flex-1 overflow-y-auto overflow-x-hidden">
        <%= render "shared/flash" %>
        <!-- PADDING LOGIC:
             If user is signed in, add p-8 for breathing room.
             If not (Login page), use p-0 so the gradient touches the edges. -->
        <div class="min-h-full flex flex-col <%= user_signed_in? ? 'p-6 md:p-10' : 'p-0' %>">
          <%= yield %>
        </div>
      </main>
      <footer class="bg-hamzis-white/10 backdrop-blur-md dark:bg-hamzis-black/20
                     border-t border-hamzis-brown/20 px-6 py-3 shrink-0 z-10">
        <div class="flex items-center justify-between">
          <p class="text-xs sm:text-sm opacity-80">Â© <%= Time.current.year %> Hamzis Systems â€” All rights reserved.</p>
          <button id="theme-toggle" class="px-3 py-1 rounded bg-hamzis-copper text-hamzis-white hover:bg-hamzis-black transition-colors">
            <span id="theme-icon">ðŸŒ™</span>
          </button>
        </div>
      </footer>
    </div>
    <script nonce="<%= content_security_policy_nonce %>">
      (() => {
        const root = document.documentElement;
        const storageKey = "hamzis-theme";
        const icon = document.getElementById("theme-icon");
        function applyTheme(dark) {
          root.classList.toggle("dark", dark);
          localStorage.setItem(storageKey, dark ? "dark" : "light");
          if (icon) icon.textContent = dark ? "ðŸŒž" : "ðŸŒ™";
        }
        function initTheme() {
          const saved = localStorage.getItem(storageKey);
          const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
          applyTheme(saved === "dark" || (!saved && prefersDark));
        }
        initTheme();
        document.getElementById("theme-toggle").onclick = () => applyTheme(!root.classList.contains("dark"));
        document.addEventListener("turbo:load", initTheme);
      })();
    </script>
    <%= render 'shared/confirm_delete_modal', title: "Confirm Deletion", message: "Are you sure?", confirm_path: "#" %>
  </body>
</html>
