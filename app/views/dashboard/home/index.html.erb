<%# app/views/dashboard/home/index.html.erb %>
<div class="relative min-h-screen space-y-8 overflow-hidden pb-12">
  <%# Background Decorative Logo %>
  <div class="absolute inset-0 z-0 pointer-events-none select-none flex items-center justify-center overflow-hidden">
    <img src="<%= asset_path('company-logo.svg') %>" alt="" class="w-3/4 h-3/4 object-contain opacity-[0.03] dark:opacity-[0.05]" />
  </div>
  <div class="relative z-10 container mx-auto px-4 sm:px-6">
    <%# 1. Header Section %>
    <%= render "dashboard/header" %>
    <%# 2. KPI Section (Always visible, scoped by controller data) %>
    <div class="mb-10">
      <%= render "dashboard/kpi_row",
          projects: @projects,
          tasks: @tasks,
          reports: @reports,
          transactions: @transactions,
          expenses: @expenses,
          low_stock_items: @low_stock_items,
          pending_leaves_count: @pending_leaves_count %>
    </div>
    <%# 3. Tab Navigation %>
    <div class="mb-6">
      <%= render "dashboard/tabs" %>
    </div>
    <%# 4. Main Content Area %>
    <div id="dashboard-content-container" class="transition-all duration-500">
      <%# --- PROFILE TAB --- %>
      <div id="profile-tab" class="tab-content">
        <% if @employee %>
          <%= render "dashboard/profile_tab", employee: @employee %>
        <% end %>
      </div>
      <%# --- OPERATIONS TABS --- %>
      <div id="projects-tab" class="tab-content hidden">
        <%= render "dashboard/projects_tab", projects: @projects %>
      </div>
      <div id="tasks-tab" class="tab-content hidden">
        <%= render "dashboard/tasks_tab", tasks: @tasks %>
      </div>
      <div id="reports-tab" class="tab-content hidden">
        <%= render "dashboard/reports_tab", reports: @reports %>
      </div>
      <%# --- LOGISTICS TAB --- %>
      <div id="inventory-tab" class="tab-content hidden">
        <%= render "dashboard/inventory_tab",
                   inventory_items: @inventory_items,
                   inventory_totals: @inventory_totals %>
      </div>
      <%# --- FINANCE TABS --- %>
      <div id="transactions-tab" class="tab-content hidden">
        <%= render "dashboard/transactions_tab", transactions: @transactions %>
      </div>
      <div id="expenses-tab" class="tab-content hidden">
        <%= render "dashboard/expenses_tab", expenses: @expenses %>
      </div>
      <%# --- HR TAB --- %>
      <div id="hr-tab" class="tab-content hidden">
        <% if @employee || current_user.role_admin? || current_user.role_ceo? || current_user.role_hr? %>
          <%= render "dashboard/hr_tab", employee: @employee, leaves: @leaves %>
        <% else %>
          <div class="py-20 text-center border border-dashed border-brand-secondary/20 rounded-2xl bg-brand-secondary/5">
            <p class="text-[10px] font-black uppercase tracking-widest text-brand-secondary/40">Personnel Data Restricted</p>
            <p class="text-[9px] text-brand-secondary/30 mt-1 uppercase italic">Insufficient clearance for HR intelligence access.</p>
          </div>
        <% end %>
      </div>
    </div>
    <%# 5. Tab Interaction Logic %>
    <script nonce="<%= content_security_policy_nonce %>">
      (() => {
          const links = document.querySelectorAll(".tab-link");
          const contents = document.querySelectorAll(".tab-content");

          links.forEach(link => {
              link.addEventListener("click", (e) => {
                  e.preventDefault();
                  const targetId = link.getAttribute("data-tab") + "-tab";

                  // Update Tab Link Styles
                  links.forEach(l => {
                      l.classList.remove("bg-brand-primary", "text-white", "shadow-lg");
                      l.classList.add("text-brand-secondary/60", "dark:text-brand-primary/60");
                  });

                  link.classList.add("bg-brand-primary", "text-white", "shadow-lg");
                  link.classList.remove("text-brand-secondary/60", "dark:text-brand-primary/60");

                  // Update Content Visibility
                  contents.forEach(c => {
                      c.classList.add("hidden");
                      c.classList.remove("animate-in", "fade-in", "slide-in-from-bottom-2");
                  });

                  const activeTab = document.getElementById(targetId);
                  if (activeTab) {
                      activeTab.classList.remove("hidden");
                      activeTab.classList.add("animate-in", "fade-in", "duration-500", "slide-in-from-bottom-2");
                  }
              });
          });
      })();
    </script>
  </div>
</div>