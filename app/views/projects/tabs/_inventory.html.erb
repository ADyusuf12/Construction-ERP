<% if policy([ :inventory, ProjectInventory.new(project: project) ]).create? %>
  <%= render "inventory/project_inventories/form", project_inventory: ProjectInventory.new(project: project) %>
<% end %>
<% if project.project_inventories.any? %>
  <h3 class="text-xl font-bold mb-4">Project Inventory</h3>
  <table class="min-w-full text-sm text-left border-collapse">
    <thead>
      <tr class="bg-hamzis-brown/10 dark:bg-hamzis-copper/10 text-xs uppercase tracking-wide">
        <th class="px-4 py-3">Item</th>
        <th class="px-4 py-3 text-center" colspan="3">Quantity</th>
        <th class="px-4 py-3">Warehouse</th>
        <th class="px-4 py-3">Purpose</th>
        <th class="px-4 py-3">Actions</th>
      </tr>
      <tr class="bg-hamzis-brown/5 dark:bg-hamzis-copper/5 text-xs uppercase tracking-wide">
        <th></th>
        <th class="px-4 py-2 text-center">Reserved</th>
        <th class="px-4 py-2 text-center">Issued</th>
        <th class="px-4 py-2 text-center">At Site</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody class="divide-y divide-hamzis-brown/20">
      <% project.project_inventories.each do |pi| %>
        <tr class="hover:bg-hamzis-white/40 dark:hover:bg-hamzis-black/40 transition">
          <!-- Item -->
          <td class="px-4 py-3 font-medium"><%= pi.inventory_item&.name || "—" %></td>
          <!-- Reserved -->
          <td class="px-4 py-3 text-center">
            <%= pi.quantity_reserved %>
            <span class="text-xs text-gray-500"><%= pi.inventory_item&.unit.presence || "pcs" %></span>
          </td>
          <!-- Issued -->
          <td class="px-4 py-3 text-center">
            <%= pi.issued_quantity %>
            <span class="text-xs text-gray-500"><%= pi.inventory_item&.unit.presence || "pcs" %></span>
          </td>
          <!-- At Site -->
          <td class="px-4 py-3 text-center">
            <%= pi.site_quantity %>
            <span class="text-xs text-gray-500"><%= pi.inventory_item&.unit.presence || "pcs" %></span>
          </td>
          <!-- Warehouse -->
          <td class="px-4 py-3"><%= pi.warehouse&.name || "—" %></td>
          <!-- Purpose -->
          <td class="px-4 py-3"><%= pi.purpose.presence || "—" %></td>
          <!-- Actions -->
          <td class="px-4 py-3 flex gap-2">
            <% if policy([ :inventory, pi ]).update? %>
              <%= link_to "Edit", edit_inventory_project_inventory_path(pi),
                  class: "px-3 py-1 rounded bg-gray-600 text-white text-xs" %>
            <% end %>
            <% if policy([ :inventory, pi ]).destroy? %>
              <%= button_to "Remove", "#",
                  class: "px-3 py-1 rounded bg-red-600 text-white text-xs hover:bg-red-700 transition",
                  form: {
                    "data-action" => "click->confirm-delete#open",
                    "data-confirm-delete-title-param" => "Cancel Reservation?",
                    "data-confirm-delete-message-param" => "Are you sure you want to cancel this reservation of #{pi.quantity_reserved} #{pi.inventory_item&.unit} '#{pi.inventory_item&.name}'? Stock will be released back.",
                    "data-confirm-delete-confirm-path-param" => inventory_project_inventory_path(pi)
                  } %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p class="text-sm text-gray-500">No inventory reserved or issued for this project yet.</p>
<% end %>
