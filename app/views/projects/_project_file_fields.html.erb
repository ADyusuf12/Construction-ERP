<div class="project-file-block nested-fields space-y-4 border border-hamzis-brown/20 rounded-xl p-5 mb-4 bg-white/20 dark:bg-black/10 transition-all"
     data-persisted="<%= f.object.persisted? %>">
  <div class="flex justify-between items-start gap-4">
    <div class="flex-1 space-y-4">
      <%# Status Badge for Persisted Files %>
      <% if f.object.persisted? %>
        <div class="flex flex-col gap-1">
          <span class="w-fit px-2 py-0.5 text-[9px] font-black uppercase tracking-widest bg-hamzis-copper text-white rounded">Cloud Vault Record</span>
          <p class="text-[10px] text-hamzis-brown/50 dark:text-hamzis-copper/50 italic leading-tight">
            Replacing the file here will overwrite the existing document in storage.
          </p>
        </div>
      <% end %>
      <!-- Title Input -->
      <div>
        <div class="flex items-center gap-2 mb-1.5">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-hamzis-copper" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          <%= f.label :title, class: "text-[10px] font-bold uppercase tracking-wider text-hamzis-brown/70 dark:text-hamzis-copper/70" %>
        </div>
        <%= f.text_field :title, placeholder: "e.g. Architectural Blueprint Rev 2",
              class: "w-full px-4 py-2 border border-hamzis-brown/20 rounded-lg bg-white/50 dark:bg-black/20 text-sm text-gray-900 dark:text-white focus:ring-1 focus:ring-hamzis-copper transition outline-none" %>
      </div>
      <!-- File Handling -->
      <div class="p-3 rounded-lg border border-dashed border-hamzis-brown/20 bg-white/10">
        <% if f.object.persisted? && f.object.file.attached? %>
          <div class="flex items-center gap-3">
            <% if f.object.file.image? %>
              <%= image_tag f.object.file.variant(resize_to_limit: [100, 100]), class: "rounded-md shadow-sm border border-white/20" %>
            <% else %>
              <div class="p-2 rounded bg-hamzis-copper/10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-hamzis-copper" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
            <% end %>
            <div class="flex-1 overflow-hidden">
              <p class="text-[10px] font-bold text-hamzis-brown dark:text-hamzis-copper uppercase opacity-50">Current Attachment</p>
              <p class="text-xs truncate font-medium dark:text-hamzis-copper"><%= f.object.file.filename %></p>
            </div>
          </div>
        <% end %>
        <div class="<%= 'mt-3 pt-3 border-t border-hamzis-brown/10' if f.object.persisted? %>">
          <div class="flex items-center gap-2 mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-hamzis-copper" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
            <%= f.label :file, f.object.persisted? ? "Replace File" : "Upload Document", class: "text-[10px] font-bold uppercase tracking-wider text-hamzis-brown/70 dark:text-hamzis-copper/70" %>
          </div>
          <%= f.file_field :file, direct_upload: true,
                class: "block w-full text-[10px] text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-[10px] file:font-black file:uppercase file:bg-hamzis-copper file:text-white hover:file:bg-hamzis-black cursor-pointer" %>
        </div>
      </div>
      <!-- Description Area -->
      <div>
        <div class="flex items-center gap-2 mb-1.5">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-hamzis-copper" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
          </svg>
          <%= f.label :description, "Notes", class: "text-[10px] font-bold uppercase tracking-wider text-hamzis-brown/70 dark:text-hamzis-copper/70" %>
        </div>
        <%= f.text_area :description, rows: 2, placeholder: "Briefly explain the contents of this file...",
              class: "w-full px-4 py-2 border border-hamzis-brown/20 rounded-lg bg-white/50 dark:bg-black/20 text-sm text-gray-900 dark:text-white focus:ring-1 focus:ring-hamzis-copper transition outline-none" %>
      </div>
    </div>
    <!-- Removal Action -->
    <div class="shrink-0 pt-2">
      <%= f.hidden_field :_destroy, class: "destroy-checkbox" %>
      <%# Dynamic remove button logic based on persistence %>
      <button type="button"
              data-action="click->project-files#<%= f.object.persisted? ? 'markDestroy' : 'removeNew' %>"
        class="p-2 text-red-500 hover:bg-red-500/10 rounded-lg transition-colors group"
        title="Discard this entry">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform group-hover:scale-110 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M1 7h22M10 3h4a1 1 0 011 1v1H9V4a1 1 0 011-1z" />
        </svg>
      </button>
    </div>
  </div>
</div>
