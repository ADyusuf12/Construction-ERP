<%= form_with(model: @project, local: true, class: "space-y-6 hr-form", data: { controller: "project-files" }) do |f| %>
  <%# Error Handling %>
  <% if @project.errors.any? %>
    <div class="p-4 rounded-2xl bg-red-500/10 border border-red-500/30 text-red-600 dark:text-red-400 backdrop-blur-md">
      <div class="flex items-center gap-2 mb-2">
        <svg xmlns="http://www.w3.org" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        <h3 class="font-bold uppercase tracking-widest text-xs">
          <%= pluralize(@project.errors.count, "error") %> identified
        </h3>
      </div>
      <ul class="list-disc ml-6 text-xs space-y-1 opacity-90">
        <% @project.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
    <!-- Project Details Card -->
    <div class="bg-hamzis-white/30 dark:bg-hamzis-black/30 border border-hamzis-brown/20 rounded-2xl p-6 shadow-xl backdrop-blur-sm">
      <div class="flex items-center gap-2 mb-6">
        <div class="p-2 rounded-lg bg-hamzis-copper/10 text-hamzis-copper">
          <svg xmlns="http://www.w3.org" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
          </svg>
        </div>
        <h4 class="text-sm font-black uppercase tracking-widest text-hamzis-brown dark:text-hamzis-copper">Core Specifications</h4>
      </div>
      <div class="space-y-5">
        <div>
          <%= f.label :name, "Project Title", class: "block text-[10px] font-bold uppercase tracking-wider mb-1 text-hamzis-brown/70 dark:text-hamzis-copper/70" %>
          <%= f.text_field :name, placeholder: "e.g. Skyline Residence Phase 1",
                class: "w-full px-4 py-2.5 border border-hamzis-brown/20 rounded-xl bg-white/50 dark:bg-black/20 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-hamzis-copper transition outline-none" %>
        </div>
        <div>
          <%= f.label :description, "Project Brief", class: "block text-[10px] font-bold uppercase tracking-wider mb-1 text-hamzis-brown/70 dark:text-hamzis-copper/70" %>
          <%= f.text_area :description, rows: 4, placeholder: "Describe the scope and client requirements...",
                class: "w-full px-4 py-2.5 border border-hamzis-brown/20 rounded-xl bg-white/50 dark:bg-black/20 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-hamzis-copper transition outline-none" %>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :status, class: "block text-[10px] font-bold uppercase tracking-wider mb-1 text-hamzis-brown/70 dark:text-hamzis-copper/70" %>
            <%= f.select :status, Project.statuses.keys.map { |s| [s.titleize, s] }, {prompt: "Set Current Phase"},
                  class: "w-full px-4 py-2.5 border border-hamzis-brown/20 rounded-xl bg-white/50 dark:bg-black/20 text-sm dark:text-hamzis-copper focus:ring-2 focus:ring-hamzis-copper transition outline-none" %>
          </div>
          <div>
            <%= f.label :deadline, class: "block text-[10px] font-bold uppercase tracking-wider mb-1 text-hamzis-brown/70 dark:text-hamzis-copper/70" %>
            <%= f.date_field :deadline,
                  class: "w-full px-4 py-2.5 border border-hamzis-brown/20 rounded-xl bg-white/50 dark:bg-black/20 text-sm dark:text-hamzis-copper focus:ring-2 focus:ring-hamzis-copper transition outline-none" %>
          </div>
        </div>
        <div>
          <%= f.label :budget, "Allocated Budget (₦)", class: "block text-[10px] font-bold uppercase tracking-wider mb-1 text-hamzis-brown/70 dark:text-hamzis-copper/70" %>
          <div class="relative">
            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-xs font-bold text-hamzis-brown/40 dark:text-hamzis-copper/40">₦</span>
            <%= f.number_field :budget, step: 0.01, placeholder: "0.00",
                  class: "w-full pl-8 pr-4 py-2.5 border border-hamzis-brown/20 rounded-xl bg-white/50 dark:bg-black/20 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-hamzis-copper transition outline-none" %>
          </div>
        </div>
      </div>
    </div>
    <!-- Project Files Card -->
    <div class="bg-hamzis-white/30 dark:bg-hamzis-black/30 border border-hamzis-brown/20 rounded-2xl p-6 shadow-xl backdrop-blur-sm">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-2">
          <div class="p-2 rounded-lg bg-hamzis-copper/10 text-hamzis-copper">
            <svg xmlns="http://www.w3.org" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
          </div>
          <h4 class="text-sm font-black uppercase tracking-widest text-hamzis-brown dark:text-hamzis-copper">Documentation</h4>
        </div>
        <button type="button"
                data-action="click->project-files#add"
          class="flex items-center gap-1.5 px-3 py-1.5 bg-hamzis-copper text-white rounded-lg hover:bg-hamzis-black transform transition-all active:scale-95 font-bold uppercase tracking-tighter text-[9px] shadow-md cursor-pointer">
          <svg xmlns="http://www.w3.org" class="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
          </svg>
          New File
        </button>
      </div>
      <div data-project-files-target="container" class="space-y-4 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar">
        <% if @project.project_files.any? %>
          <%= f.fields_for :project_files do |pf_fields| %>
            <%= render "project_file_fields", f: pf_fields %>
          <% end %>
        <% else %>
          <%# Initial empty state if needed %>
          <div class="text-center py-8 border-2 border-dashed border-hamzis-brown/10 rounded-xl">
            <p class="text-[10px] uppercase font-bold text-hamzis-brown/40">No attachments yet</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <%# Hidden Template for Stimulus %>
  <template data-project-files-target="template">
    <%= f.fields_for :project_files, ProjectFile.new, child_index: "NEW_RECORD" do |pf_fields| %>
      <%= render "project_file_fields", f: pf_fields %>
    <% end %>
  </template>
  <!-- Actions -->
  <div class="flex flex-col sm:flex-row items-center gap-4 pt-4 border-t border-hamzis-brown/10">
    <%= f.submit (@project.persisted? ? "Update Project" : "Initialize Project"),
          class: "w-full sm:w-auto px-10 py-4 rounded-xl bg-hamzis-copper text-white hover:bg-hamzis-black transform transition-all active:scale-95 font-black uppercase tracking-widest text-[11px] shadow-xl cursor-pointer" %>
    <%= link_to "Cancel", projects_path,
          class: "w-full sm:w-auto px-10 py-4 rounded-xl bg-hamzis-brown/10 text-hamzis-brown dark:text-hamzis-copper border border-hamzis-brown/20 hover:bg-red-500/10 hover:text-red-600 hover:border-red-500/50 transition-all text-center text-[11px] font-black uppercase tracking-widest" %>
  </div>
<% end %>
