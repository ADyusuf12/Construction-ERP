# Name of your application.
service: construction-erp-core

# Name of the container image (Update 'your-user' to your Docker Hub username)
image: your-user/construction-erp-core

# Deploy to these servers.
# Update the IP address when you get a production VPS.
servers:
  web:
    - 192.168.0.1

# Enable SSL auto certification
proxy:
  ssl: true
  host: app.earmark-systems.com # Update this to your actual domain

# Credentials for your image host (Docker Hub / GitHub Packages)
registry:
  username: your-user
  password:
    - KAMAL_REGISTRY_PASSWORD

# Inject ENV variables into containers
env:
  secret:
    - RAILS_MASTER_KEY
  clear:
    # Run Solid Queue inside Puma for a compact "all-in-one" server setup
    SOLID_QUEUE_IN_PUMA: true
    # We use the dynamic company helper we created in ApplicationHelper
    # but we can also set them here for the container environment
    COMPANY_NAME: "Earmark"
    COMPANY_SUFFIX: "Systems"

# Aliases for easier management
aliases:
  console: app exec --interactive --reuse "bin/rails console"
  shell: app exec --interactive --reuse "bash"
  logs: app logs -f
  dbc: app exec --interactive --reuse "bin/rails dbconsole"

# Persistent storage for Active Storage and SQLite (if used)
volumes:
  - "construction_erp_storage:/rails/storage"

asset_path: /rails/public/assets

builder:
  arch: amd64
